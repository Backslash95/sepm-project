<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3c.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:ng="http://xmlns.jcp.org/jsf/passthrough" xmlns:p="http://primefaces.org/ui" template="/WEB-INF/templates/main.xhtml">
	<ui:define name="content">
		<h:form id="newTaskPage">
			<p:panel header="Alle Aufgaben">
				<p:dataTable id="taskTable" var="task" value="#{taskRepository.findAll()}">
					<p:column headerText="Aufgabe">
						<h:outputText value="#{task.name}" />
					</p:column>
					<p:column headerText="Zu erledigen bis">
						<h:outputText value="#{task.deadline.toGMTString()}" />
					</p:column>
					<p:column headerText="Anzahl Personen">
						<h:outputText value="#{task.amountOfWorkers}" />
					</p:column>
					<p:column headerText="Status">
						<h:outputText value="#{task.taskState}" />
					</p:column>
					<p:dataTable id="taskTable" var="users" value="#{task.userSet}">
					<p:column headerText="Name">
						<h:outputText value="#{users.username}" />
					</p:column>
					</p:dataTable>

				</p:dataTable>

			</p:panel>
			<p:panel header="Neue Aufgabe erstellen">
				<p:commandButton action="#{taskHandler.createNewTask}" update="msgdiag" icon="ui-icon-suitcase" />


				<p:dialog id="msgdiag" modal="true" header="Neue Aufgabe" resizable="false" visible="#{taskHandler.dialogEnabled}">
					<p:messages id="message1" autoUpdate="true" closable="true" />
					<p:ajax event="close" listener="#{taskHandler.windowClosed}" />
					<h:panelGrid columns="2">
						<p:outputLabel value="Aufabenbezeichnung " />
						<p:inputText value="#{taskHandler.newTask.name}" />
						<p:outputLabel value="Anzahl Personen " />
						<p:inputText value="#{taskHandler.newTask.amountOfWorkers}" />
						<p:outputLabel value="Zu erledigen bis " />
						<p:calendar id="mask" value="#{taskHandler.newTask.deadline}" pattern="dd-MM-yyyy" mask="true" />
					</h:panelGrid>

					<p:separator />
					<p:commandButton style="margin-top:10px" icon="ui-icon-check" class="ui-button1" value="Erstellen" action="#{taskHandler.saveNewTask}" update="msgdiag taskTable" />
				</p:dialog>

			</p:panel>

			<p:panel header="Offene Aufgaben">
				<p:dataTable id="taskTableOpen" var="task" value="#{taskHandler.openTasks}">
					<p:column headerText="Aufgabe">
						<h:outputText value="#{task.name}" />
					</p:column>
					<p:column headerText="Zu erledigen bis">
						<h:outputText value="#{task.deadline.toGMTString()}" />
					</p:column>
					<p:column headerText="Anzahl Personen">
						<h:outputText value="#{task.amountOfWorkers}" />
					</p:column>
					<p:column headerText="Zuweisen">
						<p:commandButton action="#{taskHandler.assignTask(task.taskID)}" update="newTaskPage:msgdiag1" icon="ui-icon-suitcase" />
					</p:column>

				</p:dataTable>

				<p:dialog id="msgdiag1" modal="true" header="Aufgabe zuweisen" resizable="false" visible="#{taskHandler.dialogEnabled2}">
					<p:ajax event="close" listener="#{taskHandler.windowClosed}" />
					<h:panelGrid columns="2">
						<p:outputLabel value="Aufabenbezeichnung " />
						<p:outputLabel value="#{taskHandler.selectedTask.name}" />
						<p:outputLabel value="Anzahl Personen " />
						<p:outputLabel value="#{taskHandler.selectedTask.amountOfWorkers}" />
						<p:outputLabel value="Zu erledigen bis " />
						<p:outputLabel value="#{taskHandler.selectedTask.deadline.toGMTString()}" />

						<p:panel header="Eltern zuweisen">
							<p:panel>
								<h:panelGrid class="sp" columns="2">
									<p:outputLabel value="Nach Nutzernamen suchen:" />
									<p:inputText class="ip1" value="#{pickListViewParents.filterByUsername}">
										<f:ajax event="keyup" update="pickList" render="pickList" />
									</p:inputText>
								</h:panelGrid>
							</p:panel>
							<p:separator />
							<p:pickList id="pickList" value="#{pickListViewParents.usernames}" var="usernames" itemLabel="#{usernames}" itemValue="#{usernames}" />
						</p:panel>

					</h:panelGrid>

					<p:separator />
					<p:commandButton style="margin-top:10px" icon="ui-icon-check" class="ui-button1" value="Zuweisen" action="#{taskHandler.finishAssignment}" update="msgdiag1 taskTable" />
				</p:dialog>

			</p:panel>

		</h:form>
	</ui:define>
</ui:composition>