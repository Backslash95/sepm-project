<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3c.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:ng="http://xmlns.jcp.org/jsf/passthrough" xmlns:p="http://primefaces.org/ui" template="/WEB-INF/templates/main.xhtml">
	<ui:define name="content">
		<h:form id="newTaskPage">
			<p:panel header="Alle Aufgaben">
				<p:dataTable id="taskTable" var="task" value="#{taskRepository.findAll()}">
					<p:column headerText="Aufgabe">
						<h:outputText value="#{task.name}" />
					</p:column>
					<p:column headerText="Zu erledigen bis">
						<h:outputText value="#{task.deadline.toGMTString()}" />
					</p:column>
					<p:column headerText="Anzahl Personen">
						<h:outputText value="#{task.amountOfWorkers}" />
					</p:column>
					<p:column headerText="Status">
						<h:outputText value="#{task.taskState}" />
					</p:column>
					<p:dataTable id="taskTable" var="users" value="#{task.userSet}">
					<p:column headerText="Name">
						<h:outputText value="#{users.username}" />
					</p:column>
					</p:dataTable>
				</p:dataTable>
			</p:panel>
			<p:panel header="Neue Aufgabe erstellen">
				<p:commandButton action="#{taskHandler.createNewTask}" update="msgdiag newTaskPage" icon="ui-icon-suitcase" />
				<p:dialog id="msgdiag" modal="true" header="Neue Aufgabe" resizable="false" visible="#{taskHandler.dialogEnabled}">
					<p:messages id="message1" autoUpdate="true" closable="true" />
					<p:ajax event="close" listener="#{taskHandler.windowClosed}" />
					<h:panelGrid columns="2">
						<p:outputLabel value="Aufabenbezeichnung " />
						<p:inputText value="#{taskHandler.newTask.name}" />
						<p:outputLabel value="Anzahl Personen " />
						<p:inputText value="#{taskHandler.newTask.amountOfWorkers}" />
						<p:outputLabel value="Zu erledigen bis " />
						<p:calendar id="mask" value="#{taskHandler.newTask.deadline}" pattern="dd-MM-yyyy" mask="true" >
						<f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
						</p:calendar>
					</h:panelGrid>
					<p:separator />
					<p:commandButton style="margin-top:10px" icon="ui-icon-check" class="ui-button1" value="Erstellen" action="#{taskHandler.saveNewTask}" update="msgdiag taskTable newTaskPage" />
				</p:dialog>
			</p:panel>
			<p:panel header="Offene Aufgaben">
				<p:dataTable id="taskTableOpen" var="task" value="#{taskHandler.openTasks}">
					<p:column headerText="Aufgabe">
						<h:outputText value="#{task.name}" />
					</p:column>
					<p:column headerText="Zu erledigen bis">
						<h:outputText value="#{task.deadline.toGMTString()}" />
					</p:column>
					<p:column headerText="Anzahl Personen">
						<h:outputText value="#{task.amountOfWorkers}" />
					</p:column>
					<p:column headerText="Zuweisen">
						<p:commandButton action="#{taskHandler.assignTask(task.taskID)}" update="newTaskPage:msgdiag1 newTaskPage" icon="ui-icon-suitcase" />
					</p:column>
				</p:dataTable>
				<p:dialog id="msgdiag1" modal="true" header="Aufgabe zuweisen" resizable="false" visible="#{taskHandler.dialogEnabled2}">
					<p:ajax event="close" listener="#{taskHandler.windowClosed}" />
					<h:panelGrid columns="2">
						<p:outputLabel value="Aufabenbezeichnung " />
						<p:outputLabel value="#{taskHandler.selectedTask.name}" />
						<p:outputLabel value="Anzahl Personen " />
						<p:outputLabel value="#{taskHandler.selectedTask.amountOfWorkers}" />
						<p:outputLabel value="Zu erledigen bis " />
						<p:outputLabel value="#{taskHandler.selectedTask.deadline.toGMTString()}" />
						<p:panel header="Eltern zuweisen">
							<p:pickList id="pickList1" showCheckbox="true" showTargetFilter="true"  showSourceFilter="true" value="#{pickListViewParents.currentUsernames}" var="usernames" itemLabel="#{usernames}" itemValue="#{usernames}">
								<p:ajax event="transfer" listener="#{pickListViewParents.showTargetList(taskHandler.selectedTask.amountOfWorkers)}" update="pickList1"/>
							</p:pickList>
						</p:panel>
					</h:panelGrid>
					<p:separator />
					<p:commandButton style="margin-top:10px" icon="ui-icon-check" class="ui-button1" value="Zuweisen" action="#{taskHandler.finishAssignment}" update="newTaskPage msgdiag1 taskTable" />
				</p:dialog>		
			</p:panel>
							<p:panel header="Eltern ohne Aufgaben">
					<p:dataTable id="lazyparents" var="par" value="#{taskHandler.parentsWithoutTask()}">
					<p:column headerText="parent">
						<h:outputText value="#{par.username}" />
					</p:column>
					</p:dataTable>
				</p:panel>
		</h:form>
	</ui:define>
</ui:composition>